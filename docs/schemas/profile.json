{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://koriym.github.io/Koriym.SemanticLogger/schemas/profile.json",
  "title": "BEAR.Resource Profile Data",
  "description": "Schema for profiling data collected during resource processing within the BEAR.Resource framework",
  "links": [
    {
      "anchor": "#/xdebug/data",
      "rel": "describedby",
      "href": "https://xdebug.org/docs/trace#Output-Formats",
      "title": "Xdebug Trace Format"
    },
    {
      "anchor": "#/xhprof/data",
      "rel": "describedby",
      "href": "https://github.com/tideways/php-xhprof-extension?tab=readme-ov-file#data-format",
      "title": "XHProf Profile Format"
    },
    {
      "anchor": "#/php/backtrace",
      "rel": "describedby",
      "href": "https://www.php.net/manual/en/function.debug-backtrace.php",
      "title": "PHP debug_backtrace() Function"
    }
  ],
  "type": "object",
  "properties": {
    "xhprof": {
      "oneOf": [
        {
          "type": "array",
          "maxItems": 0,
          "description": "Empty array when XHProf is not available"
        },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "description": "Raw XHProf profiling data with function call metrics. Captured using xhprof_enable() and xhprof_disable() functions. Provides statistical performance data (wall time, memory usage, call counts) with low overhead, enabling production-ready performance monitoring unlike more intrusive tracing methods.",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "wt": {
                    "type": "integer",
                    "description": "Wall time in microseconds"
                  },
                  "mu": {
                    "type": "integer", 
                    "description": "Memory usage in bytes"
                  },
                  "pmu": {
                    "type": "integer",
                    "description": "Peak memory usage in bytes"
                  },
                  "ct": {
                    "type": "integer",
                    "description": "Call count"
                  }
                }
              }
            },
            "spec_url": {
              "type": "string",
              "format": "uri",
              "description": "URL to XHProf data format specification"
            }
          },
          "additionalProperties": false
        }
      ],
      "description": "XHProf performance profiling data with specification URL"
    },
    "xdebug": {
      "oneOf": [
        {
          "type": "array",
          "maxItems": 0,
          "description": "Empty array when Xdebug trace is not available"
        },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "string",
              "description": "Raw Xdebug trace file content in trace format 4. Captured using xdebug_start_trace() and xdebug_stop_trace() functions. Provides granular execution flow beyond PHP's standard debug_backtrace(), capturing function entry/exit with precise timestamps, memory usage, and call depth for comprehensive performance analysis and bottleneck identification."
            },
            "spec_url": {
              "type": "string",
              "format": "uri",
              "description": "URL to Xdebug trace output formats specification"
            }
          },
          "additionalProperties": false
        }
      ],
      "description": "Xdebug execution trace data with specification URL. Provides detailed function-by-function execution flow that standard PHP profiling cannot capture, essential for identifying complex performance issues, recursive calls, and execution path bottlenecks."
    },
    "php": {
      "type": "object",
      "properties": {
        "backtrace": {
          "type": "array",
          "description": "PHP backtrace information captured using debug_backtrace() function",
          "items": {
            "type": "object",
            "properties": {
              "function": {
                "type": "string",
                "description": "Function name"
              },
              "file": {
                "type": "string",
                "description": "File path"
              },
              "line": {
                "type": "integer",
                "description": "Line number"
              },
              "class": {
                "type": "string",
                "description": "Class name (if applicable)"
              },
              "type": {
                "type": "string",
                "enum": ["::", "->"],
                "description": "Method call type"
              }
            },
            "required": ["function"],
            "additionalProperties": true
          }
        }
      },
      "required": ["backtrace"]
    }
  },
  "additionalProperties": false
}